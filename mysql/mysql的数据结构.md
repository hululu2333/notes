### mysql的数据结构

***

数据结构是由一些数据，和这些数据之间的存在的关系组成的集合

索引是一种数据结构，当表比较大时索引也比较占内存，所以索引平时以索引文件的形式储存在磁盘上

mysql一般采用InnoDB为数据引擎，而InnoDB一般采用B+树来当索引的数据结构。

MyISAM数据引擎中，索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+树组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录，这叫做聚集索引，这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。

**B树与B+树：**B+树和B树相比，B+树只有叶子节点才存数据，非叶子节点只存子节点的地址。这就导致B+树能有更多的出度，从而B+树的高度会更低，导致B+树的查询效率更高

**mysql中的主键：**mysql表中必须要有主键，因为表数据文件是按主键进行聚集索引的。如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。

**主索引与辅助索引：**上文得知，在InnoDB中表数据文件本身就是主索引。当我们建立一个辅助索引时，辅助索引的结构和主索引类似，之不过辅助索引叶子节点的data域存是主键的值。所以我们通过辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。

**mysql中主键的选择：**mysql中主键的字段长度不宜过长，因为辅助索引的叶子节点的data域存的是主键的值。主键过长会导致辅助索引过大。建立mysql表时最好使用自增主键，因为使用非单调字段作为主键时，会导致插入新数据时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效

**B+树：**B+树中每个节点是一个页，InnoDB中一个页是16k。数据库每次从磁盘中加载数据都是以页为单位。

![page](F:\学习笔记\mysql\images\page.png)